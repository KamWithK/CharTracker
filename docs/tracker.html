<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="icon" href="favicon.png">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> 

  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Klee+One:wght@600&family=Noto+Sans+JP&display=swap');
  </style>
  
  <style type="text/tailwindcss">
    @layer components {
        :root {
          --default-jp-font: "Klee One";
          /* --default-jp-font: "Noto Sans JP"; */
          --default-jp-font-size: 2rem;
          --default-inactivity-blur: 0px;
          --default-text-align: 20%;
          --default-menu-blur: 8px;
        }

        input {
          border-style: none;
        }

        .jp-text {
          font-family: var(--default-jp-font);
          font-size: var(--default-jp-font-size)
        }
        .sentence-entry {
            @apply flex items-center dark:bg-slate-900 jp-text p-4 gap-4;
            filter: blur(var(--default-inactivity-blur));
        }
        .sentence {
            @apply grow inline-block text-left dark:text-slate-400 jp-text;
        }
        .delete-button {
          @apply self-center rounded-full inline-flex dark:text-indigo-500 dark:border-indigo-500 p-2 hover:bg-indigo-700 hover:text-white;
        }
        .line-select {
          @apply w-4 h-4 shrink-0 rounded-full text-indigo-500 bg-indigo-400;
        }
        .stat-numbers {
          @apply font-mono text-base whitespace-nowrap;
        }
        .stat-annotation {
          @apply text-xs tracking-tighter whitespace-nowrap;
        }
        .menu-bar {
          @apply flex items-center h-full p-3 gap-3 bg-indigo-400 bg-opacity-70 hover:filter-none hover:bg-opacity-80;
          filter: blur(var(--default-menu-blur));
        }
        .menu-buttons {
          @apply text-left col-span-2 p-4 dark:bg-slate-900 text-white hover:bg-slate-700;
        }
        .menu-input {
          @apply col-start-2 p-1 grow bg-slate-700 text-gray-300;
        }
        .menu-label {
          @apply p-4 dark:bg-slate-900 text-white;
        }
    }
  </style>
</head>

<!-- <body class="dark:bg-slate-800 px-120" style="margin-bottom: 25%;"> -->
<body class="dark:bg-slate-800 px-12">
  <div class="flex z-50 h-20 py-3 bg-slate-800 items-start sticky top-0 justify-between">
    <input id="game_name" class="w-20 h-full shrink grow justify-self-start text-5xl jp-text bg-transparent text-indigo-400" type="text" value="Game" disabled="true"> <!-- REPLACE WITH GAME NAME -->

    <div class="relative dropdown h-full">
      <div class="menu-bar">
        <div id="chars_read" class="stat-numbers">000,000</div>
        <div class="stat-annotation">Chars</div>
        <span class="material-icons">auto_stories</span>

        <div id="lines_read" class="stat-numbers">00,000</div>
        <div class="stat-annotation">Lines</div>
        <span class="material-icons">drive_file_rename_outline</span>

        <div id="elapsed_time" class="stat-numbers">00:00:00</div>
        <div class="stat-annotation">Elapsed</div>
        <span class="material-icons">timer</span>

        <div id="chars_per_hour" class="stat-numbers">00,000</div>
        <div class="stat-annotation">Chars / Hour</div>
        <span id="activity_symbol" class="material-icons">bedtime</span> <!-- bedtime off, hourglass_bottom on -->

        <input id="menu_dropdown" class="hidden" type="checkbox" onchange="showMenu(this.checked)">
          <span class="material-icons rounded-full hover:bg-indigo-700" onclick="document.getElementById('menu_dropdown').click()">more_vert</span>
        </input>
      </div>

      <div id="dropdown_menu" class="hidden absolute left-0 right-0 grid-rows-2">
        <div class="menu-label">Font</div>
        <input id="font" onchange="fontChanged(this.value)" class="menu-input" type="text" value="Klee One">

        <div class="menu-label">Font Size (rem)</div>
        <input id="font_size" onchange="fontSizeChanged(this.value)" class="menu-input" type="number" value=2>

        <div class="menu-label">Bottom Pushback (%)</div>
        <input id="bottom_line_padding" class="menu-input" type="number" value=20>
        
        <div class="menu-label">Max AFK Time (secs)</div>
        <input id="afk_max_time" class="menu-input" type="number" value=60>

        <div class="menu-label">Max Loaded Lines (UI)</div>
        <input id="max_loaded_lines" class="menu-input" type="number" value=5000>

        <div class="menu-label">Inactivity Blur (px)</div>
        <input id="inactivity_blur" class="menu-input" type="number" value=2>

        <div class="menu-label">Menu Blur (px)</div>
        <input id="menu_blur" class="menu-input" type="number" value=8>
        
        <button id="export_stats" class="menu-buttons">Export Stats</button>
        <button id="export_lines" class="menu-buttons">Export Lines</button>
        <button class="menu-buttons" onclick="document.getElementById('import_stats').click()">
          Import Stats
          <input id="import_stats" class="hidden" type="file"></input>
        </button>
        <button id="view_stats" class="menu-buttons">View Stats</button>
      </div>
    </div>
    <button id="delete-selection" class="material-icons delete-button">delete</button>
  </div>

  <div id="entry_holder" class="flex flex-col gap-2" style="padding-bottom: var(--default-text-align)">
  </div>
</body>
</html>

<script>
  function fontChanged(font) {
    document.documentElement.style.setProperty("--default-jp-font", font)
  }

  function fontSizeChanged(font_size) {
    document.documentElement.style.setProperty("--default-jp-font-size", font_size + "rem")
  }

  let element_holder = document.getElementById("entry_holder")
  function mutationScroll(mutation_list, observer) {
    window.scrollTo(0, element_holder.scrollHeight)
  }
  
  let menu = document.getElementById("dropdown_menu")
  function showMenu(checked) {
    menu.style.display = checked ? "grid" : "none"
  }
  
  element_holder.addEventListener("click", _ => {
    menu.checked = false
    menu.style.display = "none"
  })

  const observer = new MutationObserver(mutationScroll)
  observer.observe(element_holder, {"childList": true, "subtree": true})
</script>
