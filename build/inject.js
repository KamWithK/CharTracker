(()=>{function _(e){return e.length}function o(e){return e.split(`
`),e.split(`
`).length}var b=1*60*60*1e3;async function d(){return new Promise((e,t)=>{chrome.storage.local.get("previously_hooked",function(n){(n===void 0||n.previously_hooked===void 0)&&t(),chrome.storage.local.get(n.previously_hooked,function(i){e(i)})})})}function l(e,t,n){line_key=JSON.stringify([e,t]),chrome.storage.local.remove(line_key),chrome.storage.local.get(e,function(i){last_read_date=i[e].dates_read_on.at(-1),game_date_key=e+"_"+last_read_date,chrome.storage.local.get(game_date_key,function(a){a[game_date_key].lines_read-=o(n),a[game_date_key].chars_read-=_(n),chrome.storage.local.set(a)})})}console.log("Injected");var r;function g(e){document.title="CharTracker | "+game_name,chrome.storage.local.get(r,function(t){t[Object.keys(t)[0]].name=e.target.value,chrome.storage.local.set(t)})}document.getElementById("game_name").onchange=g;async function s(){game_name_heading=document.getElementById("game_name"),game_name_heading.disabled=!0,game_entry=await d(),game_name=game_entry[Object.keys(game_entry)[0]].name,game_name_heading.value=game_name,game_name_heading.disabled=!1,"game_name"in window&&(document.title="CharTracker | "+game_name)}s();function u(e,t,n){try{if(parsed=JSON.parse(e),t=="undefined"&&typeof n=="string"&&typeof e=="string"&&parsed.length==2&&typeof parsed[0]=="string"&&Number.isInteger(parsed[1]))return parsed}catch{}return!1}function y(e,t,n){try{return typeof e=="string"&&typeof n=="object"&&"lines_read"in n&&"chars_read"in n&&"time_read"in n&&"last_line_recieved"in n}catch{}return!1}function f(e){confirmed=confirm(`Are you sure you'd like to delete this line?
Char and line statistics will be modified accordingly however time read won't change...`),confirmed&&(element_div=e.target.parentNode,line_id=Number.parseInt(element_div.dataset.line_id),line=element_div.querySelector(".sentence").textContent,l(r,line_id,line),element_div.remove())}function m(e,t){return container_div=document.createElement("div"),new_svg=document.createElement("svg"),new_p=document.createElement("p"),new_button=document.createElement("button"),container_div.classList.add("sentence-entry"),new_svg.classList.add("circle-bullet-point"),new_p.classList.add("sentence"),new_button.classList.add("delete-button"),new_button.classList.add("material-icons"),container_div.dataset.line_id=t,new_p.innerHTML=e,new_button.innerHTML="delete",new_button.onclick=f,container_div.appendChild(new_svg),container_div.appendChild(new_p),container_div.appendChild(new_button),container_div}function h(e,t){entry_holder=document.getElementById("entry_holder"),new_div=m(e,t),entry_holder.appendChild(new_div)}async function c(){game_entry=await d(),r=Object.keys(game_entry)[0],max_line_id=game_entry[r].last_line_added,id_queries=[...Array(max_line_id+1).keys()].map(e=>JSON.stringify([r,e])),chrome.storage.local.get(id_queries,function(e){line_divs=[];for(let[t,n]of Object.entries(e))line_id=JSON.parse(t)[1],line_divs.push(m(n,line_id));document.getElementById("entry_holder").replaceChildren(...line_divs)})}c();function v(e,t){document.getElementById("chars_read").innerHTML=e.toLocaleString(),average=Math.round(e/(t/(60*60*1e3))),document.getElementById("chars_per_hour").innerHTML=average.toLocaleString()}chrome.storage.local.onChanged.addListener(function(e,t){for(let[n,{oldValue:i,newValue:a}]of Object.entries(e))y(n,i,a)&&v(a.chars_read,a.time_read),u(n,i,a)&&(s(),process_path=n[0],line_id=n[1],line=a,process_path!=r?c():h(line,line_id))});})();
