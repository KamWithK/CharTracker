(()=>{function d(e){return e.length}function o(e){return e.split(`
`),e.split(`
`).length}var g=1,u=1/1e3;g*=60*60*1e3;u*=60*60*1e3;async function _(){return new Promise((e,t)=>{chrome.storage.local.get("previously_hooked",function(n){(n===void 0||n.previously_hooked===void 0)&&reject(),chrome.storage.local.get(n.previously_hooked,function(r){e(r)})})})}function l(e,t,n){line_key=JSON.stringify([e,t]),chrome.storage.local.remove(line_key),chrome.storage.local.get(e,function(r){last_read_date=r[e].dates_read_on.at(-1),game_date_key=e+"_"+last_read_date,chrome.storage.local.get(game_date_key,function(a){a[game_date_key].lines_read-=o(n),a[game_date_key].chars_read-=d(n),chrome.storage.local.set(a)})})}console.log("Injected");var i;function y(e){document.title="CharTracker | "+game_name,chrome.storage.local.get(i,function(t){t[Object.keys(t)[0]].name=e.target.value,chrome.storage.local.set(t)})}document.getElementById("game_name").onchange=y;async function s(){game_name_heading=document.getElementById("game_name"),game_name_heading.disabled=!0,game_entry=await _(),game_name=game_entry[Object.keys(game_entry)[0]].name,game_name_heading.value=game_name,game_name_heading.disabled=!1,document.title="CharTracker | "+game_name}s();function f(e,t,n){try{if(parsed=JSON.parse(e),t==null&&typeof n=="string"&&typeof e=="string"&&parsed.length==2&&typeof parsed[0]=="string"&&Number.isInteger(parsed[1]))return parsed}catch{}return!1}function h(e){confirmed=confirm(`Are you sure you'd like to delete this line?
Char and line statistics will be modified accordingly however time read won't change...`),confirmed&&(element_div=e.target.parentNode,line_id=Number.parseInt(element_div.dataset.line_id),line=element_div.querySelector(".sentence").textContent,l(i,line_id,line),element_div.remove())}function m(e,t){return container_div=document.createElement("div"),new_svg=document.createElement("svg"),new_p=document.createElement("p"),new_button=document.createElement("button"),container_div.classList.add("sentence-entry"),new_svg.classList.add("circle-bullet-point"),new_p.classList.add("sentence"),new_button.classList.add("delete-button"),new_button.classList.add("material-icons"),container_div.dataset.line_id=t,new_p.innerHTML=e,new_button.innerHTML="delete",new_button.onclick=h,container_div.appendChild(new_svg),container_div.appendChild(new_p),container_div.appendChild(new_button),container_div}function v(e,t){entry_holder=document.getElementById("entry_holder"),new_div=m(e,t),entry_holder.appendChild(new_div)}async function c(){game_entry=await _(),i=Object.keys(game_entry)[0],max_line_id=game_entry[i].last_line_added,id_queries=[...Array(max_line_id+1).keys()].map(e=>JSON.stringify([i,e])),chrome.storage.local.get(id_queries,function(e){line_divs=[];for(let[t,n]of Object.entries(e))line_id=JSON.parse(t)[1],line_divs.push(m(n,line_id));document.getElementById("entry_holder").replaceChildren(...line_divs)})}c();chrome.storage.local.onChanged.addListener(function(e,t){for(let[n,{oldValue:r,newValue:a}]of Object.entries(e))n=f(n,r,a),n&&(s(),process_path=n[0],line_id=n[1],line=a,process_path!=i?(console.log("Game Changed, Readding Lines..."),c()):v(line,line_id))});})();
