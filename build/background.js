(()=>{function o(e){return e.length}function _(e){return e.split(`
`),e.split(`
`).length}var d=1,s=1/1e3;d*=60*60*1e3;s*=60*60*1e3;async function l(e,t){return e.length==0?s:(last_date=e.pop(),char_speed=new Promise((a,r)=>{chrome.storage.local.get(t+"_"+last_date,function(n){last_game_date_entry=n[t+"_"+last_date],time_read=last_game_date_entry.time_read,chars_read=last_game_date_entry.chars_read,time_read>=d?a(time_read/chars_read):a(l(e,t))})}),char_speed)}async function i(e,t,a){return await l(e,t)*o(a)}var f=2;async function c(e,t,a,r){var n={};n[e]={name:e,dates_read_on:[a],last_line_added:0},n[e+"_"+a]=await m(e,t,r),n[JSON.stringify([e,0])]=t,chrome.storage.local.set(n)}async function m(e,t,a){return{lines_read:_(t),chars_read:o(t),time_read:await i([],e,t),last_line_recieved:a,last_session_start:a}}async function g(e,t,a,r,n){game_main_entry=e[t],game_main_entry.dates_read_on.includes(r)||game_main_entry.dates_read_on.push(r),game_main_entry.last_line_added+=1,dates_read_on=structuredClone(game_main_entry.dates_read_on),e[JSON.stringify([t,game_main_entry.last_line_added])]=a,t+"_"+r in e?(game_date_entry=e[t+"_"+r],elapsed_time=n-game_date_entry.last_line_recieved,estimate_read_time=await i(dates_read_on,t,a),game_date_entry.lines_read+=_(a),game_date_entry.chars_read+=o(a),game_date_entry.last_line_recieved=n,elapsed_time<=f*estimate_read_time?game_date_entry.time_read+=elapsed_time:(game_date_entry.time_read+=estimate_read_time,game_date_entry.last_session_start=n)):e[t+"_"+r]=await m(t,a,n),chrome.storage.local.set(e)}console.log("CharTracker");function u(e){let t=new WebSocket("ws://localhost:9001");t.onmessage=h,t.onopen=y,t.onclose=u}function y(e){console.log("Connected")}function h(e){rn=new Date,date=rn.getFullYear()+"/"+rn.getMonth()+"/"+rn.getDate(),time=rn.getTime(),data=JSON.parse(e.data),console.log("Raw Data: ",data),process_path=data.process_path,line=data.sentence,chrome.storage.local.set({previously_hooked:process_path}),chrome.storage.local.get([process_path,process_path+"_"+date],function(t){Object.keys(t).length===0?c(process_path,line,date,time):g(t,process_path,line,date,time)})}u();})();
