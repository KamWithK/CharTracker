(()=>{function o(e){return e.length}function _(e){return e.split(`
`),e.split(`
`).length}var i=1*60*60*1e3;async function d(e,a,t,r){var n={};n[e]={name:e,dates_read_on:[t],last_line_added:0},n[e+"_"+t]=await s(e,a,r),n[JSON.stringify([e,0])]=a,chrome.storage.local.set(n)}async function s(e,a,t){return{lines_read:_(a),chars_read:o(a),time_read:0,last_line_recieved:t}}async function c(e,a,t,r,n){game_main_entry=e[a],game_main_entry.dates_read_on.includes(r)||game_main_entry.dates_read_on.push(r),game_main_entry.last_line_added+=1,dates_read_on=structuredClone(game_main_entry.dates_read_on),e[JSON.stringify([a,game_main_entry.last_line_added])]=t,a+"_"+r in e?(game_date_entry=e[a+"_"+r],elapsed_time=n-game_date_entry.last_line_recieved,average_char_speed=game_date_entry.chars_read/game_date_entry.time_read,estimate_readtime=average_char_speed*o(t),console.log(average_char_speed,estimate_readtime,Math.max(i,estimate_readtime)),elapsed_time>Math.max(i,estimate_readtime)?game_date_entry.time_read+=estimate_readtime:game_date_entry.time_read+=elapsed_time,game_date_entry.lines_read+=_(t),game_date_entry.chars_read+=o(t),game_date_entry.last_line_recieved=n):e[a+"_"+r]=await s(a,t,n),chrome.storage.local.set(e)}console.log("CharTracker");function l(e){let a=new WebSocket("ws://localhost:9001");a.onmessage=g,a.onopen=m,a.onclose=l}function m(e){console.log("Connected")}function g(e){rn=new Date,date=rn.getFullYear()+"/"+rn.getMonth()+"/"+rn.getDate(),time=rn.getTime(),data=JSON.parse(e.data),console.log("Raw Data: ",data),process_path=data.process_path,line=data.sentence,chrome.storage.local.set({previously_hooked:process_path}),chrome.storage.local.get([process_path,process_path+"_"+date],function(a){Object.keys(a).length===0?d(process_path,line,date,time):c(a,process_path,line,date,time)})}l();})();
