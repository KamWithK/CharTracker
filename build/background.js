(()=>{console.log("CharTracker");var c=1,l=2,_=1/1e3;_=_*60*60*1e3;function d(e){let a=new WebSocket("ws://localhost:9001");a.onmessage=g,a.onopen=m,a.onclose=d}function m(e){console.log("Connected")}function g(e){rn=new Date,date=rn.getFullYear()+"/"+rn.getMonth()+"/"+rn.getDate(),time=rn.getTime(),data=JSON.parse(e.data),console.log("Raw Data: ",data),process_path=data.process_path,line=data.sentence,chrome.storage.local.set({previously_hooked:process_path}),chrome.storage.local.get([process_path,process_path+"_"+date],function(a){Object.keys(a).length===0?u(process_path,line,date,time):y(a,process_path,line,date,time)})}async function u(e,a,t,r){var n={};n[e]=f(e,t),n[e+"_"+t]=await p(e,a,r),n[JSON.stringify([e,0])]=a,chrome.storage.local.set(n)}async function y(e,a,t,r,n){game_main_entry=e[a],game_main_entry.dates_read_on.includes(r)||game_main_entry.dates_read_on.push(r),game_main_entry.last_line_added+=1,dates_read_on=structuredClone(game_main_entry.dates_read_on),e[JSON.stringify([a,game_main_entry.last_line_added])]=t,game_date_entry=e[a+"_"+r],elapsed_time=n-game_date_entry.last_line_recieved,estimate_read_time=await i(dates_read_on,a,t),game_date_entry.lines_read+=o(t),game_date_entry.chars_read+=s(t),game_date_entry.last_line_recieved=n,elapsed_time<=l*estimate_read_time?game_date_entry.time_read+=elapsed_time:(game_date_entry.time_read+=estimate_read_time,game_date_entry.last_session_start=n),chrome.storage.local.set(e)}async function h(e,a){return e.length==0?_:(last_date=e.pop(),char_speed=new Promise((t,r)=>{chrome.storage.local.get(a+"_"+last_date,function(n){last_game_date_entry=n[a+"_"+last_date],time_read=last_game_date_entry.time_read,chars_read=last_game_date_entry.chars_read,time_read>=c?t(time_read/chars_read):t(predictedLineReadTime(e,a))})}),char_speed)}async function i(e,a,t){return await h(e,a)*s(t)}function f(e,a){var t={name:e,dates_read_on:[a],last_line_added:0};return t}async function p(e,a,t){return{lines_read:o(a),chars_read:s(a),time_read:await i([],e,a),last_line_recieved:t,last_session_start:t}}function o(e){return e.split(`
`),e.split(`
`).length}function s(e){return e.length}d();})();
